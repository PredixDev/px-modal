<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>px-modal demo</title>

  <!-- Load webcomponentsjs + Polymer -->
  <script type="module">
import '@polymer/polymer/polymer-legacy.js';
import '@polymer/polymer/lib/elements/dom-bind.js';
import '../px-modal.js';
import '../px-modal-trigger.js';
import 'px-theme/px-theme-styles.js';

var onload = function() {
  // For native Imports, manually fire WebComponentsReady so user code
  // can use the same code path for native and polyfill'd imports.
  if (!window.HTMLImports) {
    document.dispatchEvent(
      new CustomEvent('WebComponentsReady', {bubbles: true})
    );
  }
};

var webComponentsSupported = (
  'registerElement' in document && 'import' in document.createElement('link') && 'content' in document.createElement('template')
);

if (!webComponentsSupported) {
  var script = document.createElement('script');
  script.async = true;
  script.src = '../../webcomponentsjs/webcomponents-lite.js';
  script.onload = onload;
  document.head.appendChild(script);
} else {
  onload();
}
</script>
  <script type="module" src="../../@polymer/polymer/polymer-legacy.js"></script>
  <script type="module" src="../../@polymer/polymer/lib/elements/dom-bind.js"></script>

  <!-- Load components -->
  <script type="module" src="../px-modal.js"></script>
  <script type="module" src="../px-modal-trigger.js"></script>

  <!-- FIXME(polymer-modulizer):
        These imperative modules that innerHTML your HTML are
        a hacky way to be sure that any mixins in included style
        modules are ready before any elements that reference them are
        instantiated, otherwise the CSS @apply mixin polyfill won't be
        able to expand the underlying CSS custom properties.
        See: https://github.com/Polymer/polymer-modulizer/issues/154
        -->
    <script type="module">
const $_documentContainer = document.createElement('template');

$_documentContainer.innerHTML = `<style>
    html {
      font-size: 15px;
    }
    .modal-body {
      padding: 0 1.33rem;
    }
    .username-input {
      display: block;
      margin-top: 1rem;
      width: 100%;
    }
  </style>`;

document.head.appendChild($_documentContainer.content);
</script>

  <!-- Load theme -->
  <script type="module" src="../../px-theme/px-theme-styles.js"></script>
  <script type="module">
const $_documentContainer = document.createElement('template');

$_documentContainer.innerHTML = `<custom-style>
    <style include="px-theme-styles" is="custom-style"></style>
  </custom-style>`;

document.body.appendChild($_documentContainer.content);
</script>
</head>
<body>

  <!--
    This example shows a modal with a custom accept trigger that can't be
    tapped until the user enters a valid username. A valid username must be
    a string that is 5 or more characters long. To disable the modal accept
    trigger, pass in a button to the accept-trigger slot and set the
    disabled attribute. This is a native HTML approach that will cancel all
    click events on the button. If no click events are emitted, the modal
    will not be dismissed. This approach would also work to cancel the
    reject trigger.

    NOTE: This code only demonstrates one approach to disabling a button.
    You should not copy this code directly. Instead, you should implement
    your own way of dynamically setting or removing the disabled attribute
    from a button in one of the trigger slots using your framework.
  -->

  <script type="module">
const $_documentContainer = document.createElement('template');

$_documentContainer.innerHTML = `<dom-bind>
    <template is="dom-bind">
      <px-modal header-text="Update username" accept-text="Submit" reject-text="Cancel" open-trigger="{{openTrigger}}" on-opened-changed="onModalOpenedChanged">
        <div slot="body" class="modal-body">
          <span>Fill in your new username below and tap the save button. Your username must be at least 5 characters long.</span>
          <input class="username-input" type="text" placeholder="Enter username" value="{{newUsername::change}}" on-input="onUsernameChanged">
        </div>
        <button slot="reject-trigger">Cancel</button>
        <button slot="accept-trigger" disabled\$="[[newUsernameInvalid]]">Save</button>
      </px-modal>
      <px-modal-trigger type="open" trigger="{{openTrigger}}">
        <button>Update username</button>
        <p>Current username: <strong>[[username]]</strong></p>
      </px-modal-trigger>
    </template>
  </dom-bind>`;

document.body.appendChild($_documentContainer.content);
</script>
  <script type="module">
import '@polymer/polymer/polymer-legacy.js';
import '@polymer/polymer/lib/elements/dom-bind.js';
import '../px-modal.js';
import '../px-modal-trigger.js';
import 'px-theme/px-theme-styles.js';
import { PolymerElement } from '@polymer/polymer/polymer-element.js';
const bind = PolymerElement ? document.querySelector('dom-bind') : document.querySelector('template[is="dom-bind"]');

/* Set the default username */
bind.username = 'default_user';

/* Called when the modal is opened or closed */
bind.onModalOpenedChanged = function(e) {
  const opened = e.detail.value;
  // Modal is opening
  if (opened) {
    // Clear out the username so the user can enter a new one
    bind.newUsername = '';
    // Set `newUsernameInvalid` to `true` so user has to enter a new one
    // before hitting the "Save" button
    bind.newUsernameInvalid = true;
  }
  // Modal is closing and a valid new username was entered
  if (!opened && !bind.newUsernameInvalid) {
    // Update the username
    bind.username = bind.newUsername;
  }
}

/* Called when the user types into the input inside the modal */
bind.onUsernameChanged = function(e) {
  const username = e.target.value;
  if (typeof username === 'string' && username.length >= 5) {
    // User has entered a new username that is 5 characters or longer,
    // enable the save button
    bind.newUsernameInvalid = false;
  }
  else {
    // User has not typed a username or the username is not long enough,
    // disable the save button
    bind.newUsernameInvalid = true;
  }
}
</script>
</body>
</html>
